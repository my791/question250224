<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性嗜好セルフチェックテスト</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .question-container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .category-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .question {
            margin-bottom: 15px;
            padding: 10px;
        }
        .options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .option-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .option-btn:hover {
            background: #f0f0f0;
        }
        .option-btn.selected {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }
        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .category-score {
            margin-bottom: 15px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: #007bff;
            transition: width 0.3s;
        }
        button#calculate {
            display: block;
            width: 100%;
            padding: 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 20px 0;
        }
        button#calculate:hover {
            background: #0056b3;
        }
        .diagnosis {
            margin-top: 10px;
            font-style: italic;
            color: #333;
            line-height: 1.6;
        }
        .summary {
            margin-bottom: 16px;
            line-height: 1.6;
        }
        .sm-result {
            background: #fafafa;
            border-left: 4px solid #007bff;
            padding: 10px;
            margin-top: 20px;
            border-radius: 4px;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .options {
                flex-direction: column;
            }
            .option-btn {
                width: 100%;
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <h1>性嗜好セルフチェックテスト</h1>
    <p class="summary">
        自分の性的嗜好を大まかに把握するためのセルフチェックテストです。<br>
        全36問（A～Hの32問 + Iセクション4問）に回答し「結果を計算する」を押すと、各カテゴリのスコアと診断コメントが表示されます。<br>
        また「I: S/M診断」では、より直接的に S寄り・M寄りを推測する仕組みも用意しています。<br>
        ※これはあくまでも簡易的な自己分析用ツールであり、医療・心理学的な正式診断を目的としたものではありません。
    </p>

    <div id="quiz">
        <!-- A. プレイの幅・冒険心 -->
        <div class="question-container">
            <div class="category-title">A: プレイの幅・冒険心</div>
            <div class="question" data-category="A" data-question="1">
                1. 新しいプレイや未知のシチュエーションには、好奇心を強くそそられる方だ。
                <div class="options"></div>
            </div>
            <div class="question" data-category="A" data-question="2">
                2. 自宅以外の場所でも、安全が確保できれば試してみたいと思うことがある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="A" data-question="3">
                3. 性的グッズやアイテムを調べたり購入したりするのは楽しいと思う。
                <div class="options"></div>
            </div>
            <div class="question" data-category="A" data-question="4">
                4. 「ちょっとハードかも？」と思う内容でも、パートナーがOKならやってみたい。
                <div class="options"></div>
            </div>
        </div>

        <!-- B. ライトSM -->
        <div class="question-container">
            <div class="category-title">B: ライトSM</div>
            <div class="question" data-category="B" data-question="5">
                5. 手錠・アイマスクなど、軽い拘束プレイにドキドキする。
                <div class="options"></div>
            </div>
            <div class="question" data-category="B" data-question="6">
                6. 軽いスパンキング（叩く・叩かれる）や、軽めの痛みに興奮を覚えることがある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="B" data-question="7">
                7. ちょっとした主従関係（命令・服従など）を感じるプレイに魅力を感じる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="B" data-question="8">
                8. 「乱暴に扱われたい」または「相手を少し強めに攻めたい」という願望がある。
                <div class="options"></div>
            </div>
        </div>

        <!-- C. ハードSM -->
        <div class="question-container">
            <div class="category-title">C: ハードSM</div>
            <div class="question" data-category="C" data-question="9">
                9. ピンチクリップやロウソクなど、はっきりとした痛みがある道具に興味がある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="C" data-question="10">
                10. 屈辱感や辱める・辱められるような精神的支配にも強い興奮を感じることがある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="C" data-question="11">
                11. 傷跡やアザが残っても「快感の証」だと思えるほどハードに攻めたい・攻められたい。
                <div class="options"></div>
            </div>
            <div class="question" data-category="C" data-question="12">
                12. サディスト（加虐嗜好）またはマゾヒスト（被虐嗜好）としての自覚がある。
                <div class="options"></div>
            </div>
        </div>

        <!-- D. 寝取られ/スワッピング -->
        <div class="question-container">
            <div class="category-title">D: 寝取られ / スワッピング</div>
            <div class="question" data-category="D" data-question="13">
                13. パートナーが他の人と関係を持つのを想像すると、嫉妬だけでなく興奮も感じる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="D" data-question="14">
                14. 3Pやグループでのプレイに、少し興味をそそられることがある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="D" data-question="15">
                15. 「寝取られ」シチュエーションを妄想すると、興奮度が上がるタイプだ。
                <div class="options"></div>
            </div>
            <div class="question" data-category="D" data-question="16">
                16. 誰かのパートナーを自分が奪う・寝取るような行為にも背徳感と魅力を感じる。
                <div class="options"></div>
            </div>
        </div>

        <!-- E. フェティシズム -->
        <div class="question-container">
            <div class="category-title">E: フェティシズム</div>
            <div class="question" data-category="E" data-question="17">
                17. 足・指・首筋など、特定の身体パーツへの執着やフェチ意識がある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="E" data-question="18">
                18. パートナーの体臭や下着の匂いなど、匂いフェチ的な要素が大きな興奮につながる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="E" data-question="19">
                19. ランジェリーや特殊な衣装（レザー、ラバーなど）がないと物足りないことがある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="E" data-question="20">
                20. 「フェチ対象」がないと盛り上がらない、またはコレクションをしている。
                <div class="options"></div>
            </div>
        </div>

        <!-- F. 露出・覗き -->
        <div class="question-container">
            <div class="category-title">F: 露出・覗き</div>
            <div class="question" data-category="F" data-question="21">
                21. 他人に見られるかもしれない緊張感が、むしろ興奮に変わることがある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="F" data-question="22">
                22. 自分の性的行為を第三者に覗かれたり、見られたりすることを考えると刺激的だ。
                <div class="options"></div>
            </div>
            <div class="question" data-category="F" data-question="23">
                23. 他人の行為を“盗み見”するシチュエーションにも背徳感と興味をそそられる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="F" data-question="24">
                24. 人前や屋外でのスリルある行為に憧れる気持ちがある。
                <div class="options"></div>
            </div>
        </div>

        <!-- G. ロールプレイ・非日常 -->
        <div class="question-container">
            <div class="category-title">G: ロールプレイ・非日常</div>
            <div class="question" data-category="G" data-question="25">
                25. コスプレや役になりきって行うプレイをすると、普段より大胆になれる気がする。
                <div class="options"></div>
            </div>
            <div class="question" data-category="G" data-question="26">
                26. ストーリーやセリフを設定して“演じる”ことで、興奮が高まると感じる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="G" data-question="27">
                27. 魔法やファンタジー、SFなど非現実的な世界観を絡めるとさらに盛り上がる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="G" data-question="28">
                28. 声や言葉責め、ストーリー展開など「演技的」な要素があると燃えやすい。
                <div class="options"></div>
            </div>
        </div>

        <!-- H. マニアック・エクストリーム -->
        <div class="question-container">
            <div class="category-title">H: マニアック / エクストリーム</div>
            <div class="question" data-category="H" data-question="29">
                29. 窒息プレイや極限的な拘束など、リスクが高い行為に強い魅力を感じる。
                <div class="options"></div>
            </div>
            <div class="question" data-category="H" data-question="30">
                30. 食べ物や体液など、一般的にはタブー視される要素を絡めても楽しめそう。
                <div class="options"></div>
            </div>
            <div class="question" data-category="H" data-question="31">
                31. タトゥーやピアッシング、身体改造を性感と結びつけることに興味がある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="H" data-question="32">
                32. 友人にも言えないような特殊な性癖を持っていると自覚している。
                <div class="options"></div>
            </div>
        </div>

        <!-- I. S/M診断（新規追加） -->
        <div class="question-container">
            <div class="category-title">I: S/M診断</div>
            <div class="question" data-category="I" data-question="33">
                33. 自分が相手をリードし、痛がらせたり恥ずかしがらせたりする姿を見るとゾクゾクする。
                <div class="options"></div>
            </div>
            <div class="question" data-category="I" data-question="34">
                34. 自分が支配され、責められる状況になると強い興奮を覚える。
                <div class="options"></div>
            </div>
            <div class="question" data-category="I" data-question="35">
                35. 相手が嫌がったり悲鳴をあげたりするのを見ると、さらに攻めたくなる衝動がある。
                <div class="options"></div>
            </div>
            <div class="question" data-category="I" data-question="36">
                36. 自分が辱められたり痛みを与えられると、かえってゾクゾクしてしまう。
                <div class="options"></div>
            </div>
        </div>

        <button id="calculate">結果を計算する</button>

        <div id="results" class="results">
            <h2>分析結果</h2>
            <div id="category-results"></div>
        </div>
    </div>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
    // 【1】選択肢を定義（4段階）
    const options = [
        { value: 3, text: 'はい / 強く当てはまる' },
        { value: 2, text: 'どちらかといえば当てはまる' },
        { value: 1, text: 'どちらでもない' },
        { value: 0, text: 'いいえ / 当てはまらない' }
    ];

    // すべての .options 要素に対して、上記の選択肢ボタンを生成
    const optionsContainers = document.querySelectorAll('.options');
    optionsContainers.forEach(container => {
        options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-btn';
            button.textContent = option.text;
            button.setAttribute('data-value', option.value);

            // ボタンクリックで選択を切り替える
            button.addEventListener('click', function() {
                // 同じ質問の他の選択肢を選択解除
                container.querySelectorAll('.option-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                // クリックされたボタンを選択状態に
                this.classList.add('selected');
            });

            container.appendChild(button);
        });
    });

    // 【2】診断コメント（カテゴリごとに5段階の範囲）
    //   1カテゴリ = 4問×3点 = 最大12点
    //   スコア帯 : 0-2, 3-5, 6-8, 9-10, 11-12
    const categoryCommentary = {
        'A': {
            range0_2:  '【冒険心：極めて控えめ】普段どおりの安定したプレイを好む傾向が強く、新しい試みに対しては抵抗や不安が先に立ちやすいかもしれません。',
            range3_5:  '【冒険心：やや低い】多少の興味はあるものの、実際に踏み込むハードルが高いタイプ。慣れたプレイの範囲内で楽しむのが安心という気持ちがあるでしょう。',
            range6_8:  '【冒険心：中程度】新しいプレイにもある程度前向きで、パートナー次第ではいろいろと冒険してみたい派。安全策とコミュニケーションが鍵です。',
            range9_10: '【冒険心：高い】未知の刺激にワクワクするタイプ。積極的にいろんなプレイを試してみたい好奇心を持っていますが、リスク管理には注意。',
            range11_12:'【冒険心：非常に高い】刺激を求める探究心が非常に強く、普通では物足りないと感じがち。パートナーとの合意と安全確認を常に忘れずに。'
        },
        'B': {
            range0_2:  '【ライトSM傾向：ほぼ皆無】痛みや拘束は苦手な傾向が強く、甘い雰囲気やソフトな愛撫を好むタイプかもしれません。',
            range3_5:  '【ライトSM傾向：控えめ】少しなら刺激や軽い拘束も楽しめるかも、という程度。あまり強い痛みや支配感には抵抗があるでしょう。',
            range6_8:  '【ライトSM傾向：中】程よい痛みや拘束が「スパイス」になると感じるタイプ。ソフトな主従関係を楽しむ下地があります。',
            range9_10: '【ライトSM傾向：高め】手錠やスパンキング、乱暴めのプレイに魅力を感じることが多いはず。相手との事前の意思疎通が大事です。',
            range11_12:'【ライトSM傾向：非常に高い】「ライト」の域を超えそうなほど強い刺激を求めるかも。いっそハードSMに足を踏み入れる可能性も？'
        },
        'C': {
            range0_2:  '【ハードSM傾向：低い】強い痛みや徹底的な支配・被支配にはほぼ興味がなさそう。どちらかといえばソフトなタッチを好みます。',
            range3_5:  '【ハードSM傾向：やや低め】少し激しいプレイに興味があるものの、本格的な鞭や屈辱的シチュエーションには戸惑いがあるタイプ。',
            range6_8:  '【ハードSM傾向：中】多少の痛みや屈辱が快感につながることがあり、サディスト/マゾヒスト的な一面が見え隠れしています。',
            range9_10: '【ハードSM傾向：高い】かなり強い痛みや陵辱的な要素にも興奮を覚えるタイプ。セーフワードや事前打ち合わせが必須です。',
            range11_12:'【ハードSM傾向：非常に高い】相当ディープなSMに魅力を感じる可能性大。本格的なS/Mプレイを楽しむ素質があり、自己管理と安全対策が極めて重要。'
        },
        'D': {
            range0_2:  '【寝取られ・スワッピング：ほぼ興味なし】パートナーの浮気やシェアなど考えたくない、あるいは嫉妬心が強く不安が大きいタイプです。',
            range3_5:  '【寝取られ・スワッピング：やや低め】少しの妄想なら楽しめるけど、実際はあまり現実的に考えられない。パートナーを独占したい意識がやや優勢。',
            range6_8:  '【寝取られ・スワッピング：中】妄想レベルではなかなか興奮できるが、実行にはハードルがあるかも。パートナーと話し合う余地があります。',
            range9_10: '【寝取られ・スワッピング：高め】パートナーが他人と絡むシチュエーションに強いエロティシズムを感じるタイプ。複数プレイやスワッピングにも比較的好奇心旺盛。',
            range11_12:'【寝取られ・スワッピング：非常に高い】嫉妬や背徳感が快感に直結しやすいタイプ。実際に行うなら慎重なルール設定とパートナーの合意が絶対条件。'
        },
        'E': {
            range0_2:  '【フェチ度：ほぼ皆無】特定のパーツや匂いには大きくこだわらず、全体的に受け入れやすいオールラウンダータイプ。',
            range3_5:  '【フェチ度：やや控えめ】多少気になる部分やアイテムはあるが、それがないとダメというほどではない。普通のプレイでも十分に満足可能。',
            range6_8:  '【フェチ度：中】足フェチ・匂いフェチ・ランジェリー好きなど、特定要素が刺激を大きく増幅するタイプ。フェチ要素を取り入れるとさらに高まる。',
            range9_10: '【フェチ度：高め】特定のフェチを強く求める傾向。お気に入りのアイテムや状況が揃わないと物足りないと感じやすいかも。',
            range11_12:'【フェチ度：非常に高い】フェチの対象が性行為の中心にあるほど強い執着を持つタイプ。コレクションや特定シチュエーションへのこだわりが特に強い。'
        },
        'F': {
            range0_2:  '【露出・覗き：低い】人に見られる可能性や、他人を覗き見る行為には大きな抵抗がある。落ち着けるプライベート空間での行為を好む。',
            range3_5:  '【露出・覗き：やや低め】ちょっとした背徳感には惹かれつつ、実行にはためらいが強い。危険や違法行為は絶対避けたいと思っているタイプ。',
            range6_8:  '【露出・覗き：中】「見られるかも」「隠れて覗きたい」といったシチュエーションが妄想をかき立てる。ある程度のスリルを楽しむ可能性あり。',
            range9_10: '【露出・覗き：高め】人前や屋外、または覗き見のシチュに強い興奮を感じやすい。自制心を失わないように注意が必要。',
            range11_12:'【露出・覗き：非常に高い】かなり危険な状況でも燃えてしまう可能性がある。法的トラブル回避や安全確保が最重要課題。'
        },
        'G': {
            range0_2:  '【ロールプレイ欲：ほとんどなし】コスプレや設定を作り込むよりも、自然体のセックスを好む。無理に演出しなくても十分楽しめるタイプ。',
            range3_5:  '【ロールプレイ欲：やや低め】多少は興味があるが、がっつり演じるのは照れ臭い・恥ずかしいと感じるかもしれません。簡単な小道具程度なら楽しいと思えるかも。',
            range6_8:  '【ロールプレイ欲：中】非日常感を求める傾向があり、キャラ設定やストーリー演出で普段と違う自分を楽しめるタイプ。',
            range9_10: '【ロールプレイ欲：高め】脚本を用意したり、世界観をしっかり作り込むほど燃える。言葉責めや特殊設定で大きく盛り上がれる可能性大。',
            range11_12:'【ロールプレイ欲：非常に高い】もはや演劇さながらにキャラになりきるのが当たり前。大掛かりなシチュエーションこそ至高で、想像力を存分に活かせるタイプ。'
        },
        'H': {
            range0_2:  '【マニアック度：非常に低い】タブーや極端なプレイには強い抵抗感がある。スタンダードな行為を安心して楽しみたいタイプ。',
            range3_5:  '【マニアック度：やや低め】ちょっと興味はあっても、実際に試すには不安の方が大きい。妄想だけで楽しむことが多いかもしれません。',
            range6_8:  '【マニアック度：中】一般的にはタブーな要素にも好奇心を抱きやすい。状況やパートナー次第では踏み込んでしまう可能性あり。',
            range9_10: '【マニアック度：高め】普通のプレイでは満足できず、アブノーマルで刺激的な行為を求めるタイプ。安全管理を徹底しないと危険。',
            range11_12:'【マニアック度：非常に高い】周囲に理解されにくいほど過激な嗜好を持つ可能性がある。リスクが高いプレイも検討しがちなので注意と信頼関係が不可欠。'
        },
        'I': {
            // Iカテゴリ（S/M診断の4問）のスコアに対するコメント。
            // ただし、後述の関数 "determineSMFromICategory()" でさらに詳細な S/M 判定を行います。
            range0_2:  '【S/M指向：ほぼなし】S的にもM的にもほとんど当てはまらないため、SM自体にあまり興味がない可能性が高いです。',
            range3_5:  '【S/M指向：控えめ】多少SやMの要素はあるかもしれませんが、どちらかといえばソフトな方が合うかもしれません。',
            range6_8:  '【S/M指向：中程度】SかMか、もしくは両方をバランスよく楽しめる兆候あり。痛みや屈辱の快感をある程度理解できそう。',
            range9_10: '【S/M指向：高め】S/M的な要素がかなり強い。相手を責めたい、責められたい気持ちがはっきりあるはず。',
            range11_12:'【S/M指向：非常に高い】完全にS/Mの世界に深く魅了される傾向が強いです。どちらかに強く偏る、あるいは両刀である可能性も高いでしょう。'
        }
    };

    // 【3】カテゴリ表示名
    const categoryNames = {
        'A': 'プレイの幅・冒険心',
        'B': 'ライトSM',
        'C': 'ハードSM',
        'D': '寝取られ / スワッピング',
        'E': 'フェティシズム',
        'F': '露出・覗き',
        'G': 'ロールプレイ・非日常',
        'H': 'マニアック / エクストリーム',
        'I': 'S/M診断'
    };

    // 【4】スコア帯を判定する関数
    function getCommentKey(score) {
        if (score <= 2) return 'range0_2';
        if (score <= 5) return 'range3_5';
        if (score <= 8) return 'range6_8';
        if (score <= 10) return 'range9_10';
        return 'range11_12';
    }

    // 選択肢テキストを簡略化（表示用）
    function simplifyAnswer(text) {
        if (text.includes('強く当てはまる')) return '強い同意';
        if (text.includes('どちらかといえば')) return 'やや同意';
        if (text.includes('どちらでもない')) return '中立';
        return '否定';
    }

    // 【5】Iカテゴリの回答から、S度/M度を直接判定する
    // 質問33と35 → S傾向 (相手を責める興奮)
    // 質問34と36 → M傾向 (自分が責められる興奮)
    function determineSMFromICategory(results) {
        const iCategory = results['I'];
        let sScore = 0;
        let mScore = 0;

        // 回答詳細を取得
        // Q33, Q35 -> S
        // Q34, Q36 -> M
        const q33Val = getQuestionValue('I', '33');
        const q34Val = getQuestionValue('I', '34');
        const q35Val = getQuestionValue('I', '35');
        const q36Val = getQuestionValue('I', '36');

        sScore = q33Val + q35Val;
        mScore = q34Val + q36Val;

        // 各々最大6点（3点×2問）
        // sScore と mScore を比べて結果を返す
        let smComment = '';
        if (sScore === 0 && mScore === 0) {
            smComment = 'S・Mの両面とも当てはまりがなく、SMにはあまり関心がないかもしれません。';
        } else if (sScore > mScore) {
            if (sScore >= 5) {
                smComment = '相手を責めたい・苦しめたい欲求が非常に強く、【S寄り】の本能がはっきり感じられるタイプです。';
            } else {
                smComment = 'どちらかといえば相手を責める快感を求める【S寄り】ですが、状況次第でM的要素も持ち合わせている可能性があります。';
            }
        } else if (mScore > sScore) {
            if (mScore >= 5) {
                smComment = '自分が責められたい・辱められたい欲求が強く、【M寄り】の本能が強く出ているタイプです。';
            } else {
                smComment = 'どちらかといえば責められたい欲求を感じる【M寄り】ですが、シチュエーションによってはSになる要素も残っているかもしれません。';
            }
        } else {
            // sScore === mScore
            if (sScore === 0) {
                smComment = 'SM指向が特に見られないか、ごく薄い可能性があります。';
            } else if (sScore <= 2) {
                smComment = 'SとMが同程度であり、どちらも軽度。あまりSM要素は強くないものの、両方に少し関心があるかも。';
            } else {
                smComment = 'SとM両面が同じくらい強め。いわゆる【スイッチ】傾向で、相手や気分に合わせてSにもMにもなれるタイプです。';
            }
        }

        return smComment;
    }

    // 質問の選択値を取得する補助関数
    function getQuestionValue(category, questionNum) {
        const elem = document.querySelector(`[data-category="${category}"][data-question="${questionNum}"]`);
        if (!elem) return 0;
        const selected = elem.querySelector('.option-btn.selected');
        return selected ? parseInt(selected.getAttribute('data-value')) : 0;
    }

    // 【6】「結果を計算する」ボタンクリックで集計
    document.getElementById('calculate').addEventListener('click', function() {
        // カテゴリ一覧（A～H + I）
        const categories = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
        const results = {};

        // 各カテゴリの点数を集計
        categories.forEach(category => {
            const questions = document.querySelectorAll(`[data-category="${category}"]`);
            let total = 0;
            let answered = 0;
            let detailArray = [];

            questions.forEach(question => {
                const selectedButton = question.querySelector('.option-btn.selected');
                if (selectedButton) {
                    const value = parseInt(selectedButton.getAttribute('data-value'));
                    const qNum = question.getAttribute('data-question');
                    const ans = simplifyAnswer(selectedButton.textContent);

                    total += value;
                    answered++;
                    detailArray.push(`Q${qNum}: ${ans}`);
                }
            });

            results[category] = {
                score: total,
                answered: answered,
                details: detailArray
            };
        });

        // 結果表示用の要素
        const resultsDiv = document.getElementById('results');
        const categoryResults = document.getElementById('category-results');
        categoryResults.innerHTML = '';

        // 全体合計＆回答数
        let totalScore = 0;
        let totalAnswered = 0;
        categories.forEach(cat => {
            totalScore += results[cat].score;
            totalAnswered += results[cat].answered;
        });

        // 全体の結果（総合点・回答数など）
        const totalDiv = document.createElement('div');
        totalDiv.className = 'category-score';
        totalDiv.innerHTML = `
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <strong>総合結果</strong>
                <span>合計 ${totalScore}点 (回答数: ${totalAnswered}/36)</span>
            </div>
        `;
        categoryResults.appendChild(totalDiv);

        // カテゴリごとの結果を表示
        categories.forEach(category => {
            const { score, answered, details } = results[category];
            // 1問最大3点×4問=12点が最高（Iも同じ）
            const maxPossible = answered * 3; 
            const percentage = (answered > 0 && maxPossible > 0)
                ? ((score / maxPossible) * 100).toFixed(1)
                : 0;

            // コメントキーを取得
            const commentKey = getCommentKey(score);
            const commentText = categoryCommentary[category][commentKey];

            // HTML要素を生成
            const div = document.createElement('div');
            div.className = 'category-score';
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <strong>${categoryNames[category]}</strong>
                    <span>${percentage}% (${score}点 / 最大12点)</span>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: ${percentage}%"></div>
                </div>
                <div style="font-size: 0.8em; color: #666; margin-top: 4px;">
                    回答詳細: ${details.join(' | ')}
                </div>
                <div class="diagnosis">
                    ${commentText}
                </div>
            `;
            categoryResults.appendChild(div);
        });

        // ■ Iカテゴリの結果を基に、S/M をさらに詳細に判定
        const smDiv = document.createElement('div');
        smDiv.className = 'sm-result';
        const smAnalysis = determineSMFromICategory(results);
        smDiv.innerHTML = `<strong>■ S or M 傾向（Iカテゴリからの詳細推定）</strong><br>${smAnalysis}`;
        categoryResults.appendChild(smDiv);

        // 結果ブロックを表示
        resultsDiv.style.display = 'block';
        resultsDiv.scrollIntoView({ behavior: 'smooth' });
    });
});
</script>
</body>
</html>
